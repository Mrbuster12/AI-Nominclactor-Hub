<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Treatment Plan</title>
  <link rel="stylesheet" href="./treatment_plan.css"/>
</head>

<body>

<section id="tp-header" class="tp-header">
  <h2>Treatment Plan</h2>
  <div class="status">
    <span id="planClient">Client: —</span>
    <span id="planTrack" class="badge">Track: —</span>
    <span id="planTier" class="badge">CTC: —</span>
    <span id="planVersion" class="badge">v—</span>
  </div>
</section>

<section class="tp-main">
  <aside id="tp-drawers" class="tp-drawers" aria-label="Stored Plans">
    <header>
      <h3>Plan Drawer</h3>
      <button id="btnNewVersion">Save New Version</button>
      <button id="btnRefreshFromBridges">Refresh from Modules</button>
    </header>
    <ul id="drawerList" class="drawer-list"></ul>
  </aside>

  <article id="tp-display" class="tp-display" aria-label="Current Plan">
    <header><h3>Current Plan</h3></header>

    <div class="tp-row">
      <label>Provisional Diagnosis</label>
      <div id="tpDx">—</div>
    </div>

    <!-- GOALS: system-populated list + manual notes textarea -->
    <div class="tp-row">
      <label for="tpGoalsCustom">Goals</label>
      <div class="tp-field">
        <ul id="tpGoals"></ul>
        <textarea
          id="tpGoalsCustom"
          rows="4"
          placeholder="Add or refine treatment goals here (client-centered language, measurable targets, etc.)…">
        </textarea>
      </div>
    </div>

    <!-- OBJECTIVES: system-populated list + manual notes textarea -->
    <div class="tp-row">
      <label for="tpObjectivesCustom">Objectives</label>
      <div class="tp-field">
        <ul id="tpObjectives"></ul>
        <textarea
          id="tpObjectivesCustom"
          rows="4"
          placeholder="Document specific objectives, timeframes, and behavioral anchors…">
        </textarea>
      </div>
    </div>

    <!-- INTERVENTIONS: system-populated list + manual notes textarea -->
    <div class="tp-row">
      <label for="tpInterventionsCustom">Interventions</label>
      <div class="tp-field">
        <ul id="tpInterventions"></ul>
        <textarea
          id="tpInterventionsCustom"
          rows="4"
          placeholder="List interventions, modalities, and frequency (CBT, MI, group, etc.)…">
        </textarea>
      </div>
    </div>

    <div class="tp-row">
      <label for="tpNotes">Notes</label>
      <textarea
        id="tpNotes"
        rows="5"
        placeholder="Clinician notes…">
      </textarea>
    </div>
  </article>
</section>

<!-- OPTIONAL: tiny inline style so the new fields don't look insane even if CSS doesn't know tp-field -->
<style>
  .tp-field {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .tp-field textarea {
    width: 100%;
    resize: vertical;
  }
</style>

<!-- EXISTING BRIDGE + INTEROP STACK (LEAVE THEM IN THIS ORDER) -->
<script src="/shared/bridge.js?v=5"></script>
<script src="/shared/enforce-bridge.js?v=5"></script>
<script src="/shared/core/interop-hotfix.js"></script>
<script src="./treatment_plan.view.js"></script>

<!-- NEW: BIOMETRIC CONSENT + INGEST (SAME ENGINE USED IN OTHER MODULES) -->
<script src="/shared/consent/bio_consent.js?v=1759319983"></script>
<script src="/shared/ai/biometric_ingest.js?v=1759319983"></script>

<!-- INLINE CONSENT HOOK FOR TREATMENT-PLAN VIEW -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  try {
    if (window.AIEngine && AIEngine.Consent && typeof AIEngine.Consent.ensure === 'function') {
      AIEngine.Consent.ensure('treatment-plan:view', {
        path: location.pathname,
        module: 'treatment-plan'
      });
    } else {
      console.warn('[TP] Consent engine not available on this page.');
    }
  } catch (err) {
    console.error('[TP] consent ensure failed', err);
  }
});
</script>

<!-- VOUCHER / RETINA / REFLEX STUB LOGIC (MATCHING HUB + PSYCHOSOCIAL) -->
<script src="/shared/ai/voucher_bridge.js"></script>
<script src="/shared/ai/voucher_loader.js"></script>
<script src="/shared/ui/voucher_ui.js"></script>

<script src="/ops/retina/retina_state.js"></script>
<script src="/ops/retina/retina_panel.js"></script>

<script src="/ops/reflex/holo_reflex_engine.js"></script>
<script src="/ops/reflex/overdose_engine.js"></script>
<script src="/ops/reflex/overdose_panel.js"></script>
<script src="/ops/reflex/lyria_engine.js"></script>
<script src="/ops/reflex/lyria_panel.js"></script>
<script src="/ops/reflex/psy_reflex_engine.js"></script>
<script src="/ops/reflex/projection_reflex.js"></script>

</body>
</html>

